# 多进制有理数（含p-adic）实现类 介绍文档

## 概述
本Python类`多进制有理数`实现了**任意进制下有理数的精确表示与运算**，并扩展支持p-adic（p进数）的表示与重构功能。核心解决了不同进制下有理数的约分、循环小数标记、跨进制转换、p进数处理等问题，同时重载了完整的数值运算接口，保证运算的精确性和易用性。

该类的核心特点：
- 支持自定义进制（2~符号表长度）和符号表，兼容任意合法进制表示
- 有理数的精确运算（无浮点误差），支持加减乘除、幂、取模、整除等
- 支持循环小数的标记（如`0.(3)`表示1/3）和截断处理
- 支持p-adic（p进数）的表示（含循环节）和从p-adic字符串重构有理数
- 完善的异常处理和输入验证，保证鲁棒性

## 核心功能
| 功能分类         | 具体能力                                                                 |
|------------------|--------------------------------------------------------------------------|
| 多进制基础支持   | 自定义进制/符号表、进制转换、分子分母自动约分、输入类型兼容（int/字符串） |
| 数值类型转换     | 支持`float()`/`int()`/`bool()`转换，`hash()`兼容                         |
| 运算重载         | 加减乘除、幂运算、取模、整除、比较运算（==/!=/</>等）、取反/取倒数        |
| 小数表示         | 生成带循环节的小数字符串（如`0.1(6)`）、截断位数控制、自定义进制小数      |
| 有理数逼近       | 从循环/截断小数字符串还原为最简有理数                                   |
| p-adic支持       | 生成p进数表示（含循环节）、从p-adic字符串重构有理数                     |

## 快速开始
### 环境要求
- Python 3.6+（支持f-string、__slots__等特性）
- 测试依赖：`pytest`（可选，仅运行测试用例时需要）

### 安装与导入
该类为纯Python实现，无需安装，直接复制类代码到项目中，导入即可：
python
导入类（假设类代码保存为 dy_rational.py）

from dy_rational import 多进制有理数 as DYRational


## API参考
### 类属性
| 属性名       | 类型 | 默认值                          | 说明                     |
|--------------|------|---------------------------------|--------------------------|
| 默认进制     | int  | 10                              | 初始化时默认使用的进制   |
| 默认符号表   | str  | "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ" | 默认符号表（支持36进制） |

### 初始化方法
python
def __init__(self, 分子: int str, 分母: int
 str = 1, 进制: int = None, 符号表: str = None):

- **参数说明**：
  - `分子`：有理数的分子，支持int（十进制）或字符串（指定进制）
  - `分母`：有理数的分母（默认1），支持int或字符串，不能为0
  - `进制`：自定义进制（默认使用类的`默认进制`）
  - `符号表`：自定义符号表（默认使用类的`默认符号表`）
- **核心行为**：
  - 自动对分子分母约分（欧几里得算法）
  - 验证进制和符号表的合法性（进制范围、符号表无非法字符/重复）
  - 支持负号（字符串输入仅允许开头带负号）

### 只读属性
| 属性名     | 说明                                                                 |
|------------|----------------------------------------------------------------------|
| 进制       | 当前实例使用的进制                                                   |
| 符号表     | 当前实例使用的符号表                                                 |
| 分子值     | 约分后的分子十进制整数值                                             |
| 分母值     | 约分后的分母十进制整数值（恒正）                                     |
| 分子表示   | 当前进制下分子的字符串表示（含负号）                                 |
| 分母表示   | 当前进制下分母的字符串表示（无负号）                                 |

### 核心方法
#### 1. 进制转换
python
def 进制转换(self, 进制 = None, 符号表 = None) -> 多进制有理数:

- 功能：生成新进制/符号表下的有理数实例（数值不变）
- 参数：新进制、新符号表（默认沿用当前值）
- 返回：新的`多进制有理数`实例

#### 2. 浮点数表示（带循环节）
python
def 浮点数(self, 截断位数=30) -> str:

- 功能：生成当前进制下的小数字符串（支持循环节标记）
- 参数：`截断位数`：最大小数位数，超出则添加`...`
- 返回示例：
  - 有限小数：`"0.5"`、`"101.101"`（2进制）
  - 循环小数：`"0.(3)"`（1/3）、`"0.1(6)"`（1/6）
  - 截断小数：`"0.14285..."`（1/7，截断5位）

#### 3. p-adic表示
python
def padic表示(self, 截断位数=30) -> str:

- 功能：生成当前进制下的p进数表示（支持循环节标记）
- 参数：`截断位数`：最大循环位数
- 返回示例：`"(6).9"`（7/30的10-adic表示）、`"(01)1"`（1/3的2-adic表示）

### 静态方法
#### 1. 有理数逼近
python
@staticmethod
def 有理数逼近(字符串:str, 进制 = 默认进制, 符号表 = 默认符号表) -> 多进制有理数:

- 功能：从循环/截断小数字符串还原为最简有理数
- 支持输入类型：
  - 纯整数：`"5"`、`"-101"`（2进制）
  - 有限小数：`"0.5"`、`"1.75"`
  - 循环小数：`"0.(3)"`、`"0.1(6)"`
  - 截断小数：`"0.142857..."`

#### 2. 有理数重构
python
@staticmethod
def 有理数重构(字符串:str, 进制 = 默认进制, 符号表 = 默认符号表) -> 多进制有理数:

- 功能：从p-adic字符串重构为有理数
- 支持输入类型：
  - 纯整数：`"5"`、`"101"`（2进制）
  - 有限p-adic：`"0.5"`、`"0.75"`
  - 循环p-adic：`"(6).9"`、`"(01)1"`
  - 截断p-adic：`"...66.9"`

### 运算重载
该类重载了Python原生数值运算接口，保证使用方式与内置类型一致：

| 运算类型       | 支持的运算符/方法                | 说明                                                                 |
|----------------|---------------------------------|----------------------------------------------------------------------|
| 加法           | `+`（__add__/__radd__）         | 支持实例+int、实例+实例、int+实例                                   |
| 减法           | `-`（__sub__/__rsub__）         | 支持实例-int、实例-实例、int-实例                                   |
| 乘法           | `*`（__mul__/__rmul__）         | 支持实例*int、实例*实例、int*实例                                   |
| 除法           | `/`（__truediv__/__rtruediv__） | 支持实例/int、实例/实例、int/实例（除数不能为0）                     |
| 幂运算         | `**`（__pow__/__rpow__）        | 支持实例^int、实例^有理数、int^实例（仅支持整数根的有理数幂）         |
| 取模           | `%`（__mod__/__rmod__）         | 仅支持分母为1的实例（整数取模）                                     |
| 整除           | `//`（__floordiv__/__rfloordiv__） | 仅支持分母为1的实例（整数整除）                                     |
| 比较运算       | `==/!=/</>/<=/>=`               | 支持实例与int/实例比较                                               |
| 取反           | `-`（__neg__）                  | 返回分子取反的新实例                                                 |
| 取倒数         | `~`（__invert__）               | 返回分子分母交换的新实例（倒数）                                     |
| 绝对值         | `abs()`（__abs__）              | 返回分子取绝对值的新实例                                             |

## 使用示例
### 示例1：基础初始化
python
1. 整数输入（默认10进制）

r1 = DYRational(15, 25)
print(str(r1))  # 输出：3/5
print(r1.分子值, r1.分母值)  # 输出：3 5

2. 字符串输入（自定义进制）

5进制，符号表"abcde"，分母"-be"（be=4*5+4=24）

r2 = DYRational(7, "-be", 5, "abcde")
print(str(r2))  # 输出：-bc/be
print(r2.分子值, r2.分母值)  # 输出：-7 9

3. 16进制字符串输入

r3 = DYRational("-A3", "-14", 16, "0123456789ABCDEF")
print(str(r3))  # 输出：A3/14
print(r3.分子值, r3.分母值)  # 输出：163 20


### 示例2：进制转换
python
初始5进制实例

original = DYRational(7, "-be", 5, "abcde")
转换为10进制

converted1 = original.进制转换(10)
print(str(converted1))  # 输出：-7/9

转换为2进制

converted2 = original.进制转换(2)
print(str(converted2))  # 输出：-111/1001


### 示例3：有理数运算
python
基础运算

r1 = DYRational(1, 2)  # 1/2
r2 = DYRational(1, 3)  # 1/3

加法

print(r1 + r2)  # 输出：5/6
减法

print(r1 - r2)  # 输出：1/6
乘法

print(r1 * r2)  # 输出：1/6
除法

print(r1 / r2)  # 输出：3/2
幂运算（平方根）

r3 = DYRational(16, 81)
print(r3  DYRational(1, 2))  # 输出：4/9
取倒数

print(~r1)  # 输出：2/1


### 示例4：循环小数表示与逼近
python
循环小数表示

r1 = DYRational(1, 3)
print(r1.浮点数())  # 输出：0.(3)

r2 = DYRational(1, 6)
print(r2.浮点数())  # 输出：0.1(6)

从循环小数字符串逼近有理数

r3 = DYRational.有理数逼近("0.(3)")
print(r3 == DYRational(1, 3))  # 输出：True

从截断小数逼近

r4 = DYRational.有理数逼近("0.142857...")
print(r4 == DYRational(1, 7))  # 输出：True


### 示例5：p-adic表示与重构
python
p-adic表示（7/30的10-adic）

r1 = DYRational(7, 30, 10)
print(r1.padic表示())  # 输出：(6).9

从p-adic字符串重构有理数

r2 = DYRational.有理数重构("(6).9", 10)
print(r2 == DYRational(7, 30))  # 输出：True

p-adic运算（先重构为有理数，运算后再转回p-adic）

padic_str1 = "(1)2"
padic_str2 = "(3204)4"
r3 = DYRational.有理数重构(padic_str1, 10)
r4 = DYRational.有理数重构(padic_str2, 10)
r_result = r3 * r4
padic_result = r_result.padic表示()
print(padic_result)  # 输出运算后的p-adic字符串


## 测试说明
附带的`pytest`测试用例覆盖了以下场景：
- 初始化（不同输入类型、异常场景）
- 进制转换、数值类型转换
- 所有运算重载的正确性
- 循环小数表示与逼近
- p-adic表示与重构
- 边界条件（0、负数、循环节、截断）

### 运行测试
bash
安装pytest（未安装的话）

pip install pytest

运行测试用例（假设测试文件为 test_dy_rational.py）

pytest test_dy_rational.py -v


## 总结
### 核心亮点
1. **精确运算**：基于有理数的分子分母表示，避免浮点运算误差
2. **多进制兼容**：支持任意合法进制（2~符号表长度）和自定义符号表
3. **p-adic支持**：完整的p进数表示与重构能力，适用于数论学习/研究
4. **鲁棒性**：完善的输入验证和异常处理，覆盖非法进制、符号表、输入值等场景

### 适用场景
- 数论学习与研究（尤其是p进数相关）
- 不同进制下的有理数精确运算
- 循环小数的解析与生成
- 需要避免浮点误差的数值计算场景

该类完全基于Python原生实现，无需第三方依赖，代码结构清晰，注释完善，易于扩展和定制。